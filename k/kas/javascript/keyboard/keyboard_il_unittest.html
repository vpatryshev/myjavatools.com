<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Onscreen Keyboard Test Suite. Unittest for keyboard.js</title>
<!--
Javascript unittest file. See instructions in the body.
Script paths are relative to location of this file.
Author: vpatryshev
-->
  <script src="header.js"></script>
  <script src="debug.js"></script>
  <script src="unittest_util.js"></script>
  <script src="../../../third_party/java/jsunit/jsunit2.2/app/jsUnitCore.js"></script>
  <script>
    if (!jsUnitFixTop) {
      alert("Sorry, could not find jsUnitCore.js; please check your paths...");
    }
  </script>
  <script src="keyboard.js"></script>
  <script src="kbdlayout.js"></script>
  <script src="kbdlayer.js"></script>
  <script src="keyboard_il.js"></script>
  <script src="layout/EastEuropean/RU.js"></script>
  <script src="layout/WestEuropean/EN_GB.js"></script>
  <script src="layout/MiddleEastern/AR.js"></script>
  <script src="layout/MiddleEastern/HE.js"></script>
  <script src="export.js"></script>
</head>
<body>
This is a javascript unittest for <code>keyboard_il.js</code><br>
To run the test, you have to open in your browser the following file:<br>
<code>google3/third_party/java/jsunit/jsunit2.2/testRunner.html</code><br>
and enter the location of this test file into the file name field,
and click 'Run' button.
<textarea rows="2" cols="50" id="testarea"></textarea>
<script type="text/javascript">
var kbdRestore = KBD_window._kbdInit;
var hebrewInHebrew = '\u05de\u05e7\u05dc\u05d3\u05ea';
var testMsgHebrew = hebrewInHebrew + '\u05e2\u05d1\u05e8\u05d9\u05ea';
var testMsgEnglish = "English";
var testMsgRussian = '\u0420\u0443\u0441\u0441\u043a\u0438\u0439';
var testMsgArabic = '\u0627\u0644\u0639\u0631\u0628\u064a\u0629';
var titleInactive = span(hebrewInHebrew);
var titleHebrewActive =
    '<ABBR title="Hebrew keyboard">' +
    '&nbsp;' + testMsgHebrew + '</ABBR>&nbsp;&nbsp;' +
    '<A onmouseover="this.style.textDecoration=\'underline\'" ' +
    'onmouseout="this.style.textDecoration=\'none\'" id="s2EN" ' +
    'onclick="_kbdS2(\'EN\');">English</A>&nbsp;&nbsp;' +
    '<A onmouseover="this.style.textDecoration=\'underline\'" ' +
    'onmouseout="this.style.textDecoration=\'none\'" id="s2RU" ' +
    'onclick="_kbdS2(\'RU\');">' + testMsgRussian + '</A>&nbsp;&nbsp;'+
    '<A onmouseover="this.style.textDecoration=\'underline\'" ' +
    'onmouseout="this.style.textDecoration=\'none\'" id="s2AR" ' +
    'onclick="_kbdS2(\'AR\');">' + testMsgArabic + '</A>'
;

function setUp() {
  GKBD.layer.setup();
  GKBD.layer.switchTo_('HE');
  var input = document.getElementById('testarea');
  input.value = '';
  input.focus();
}

function pressAndRelease(key) {
  var input = document.getElementById('testarea');
  var event = {target:   input,
               which:    key.toUpperCase().charCodeAt(0),
               shiftKey: key == key.toUpperCase()};
  document.onkeydown(event);
  document.onkeyup(event);
}

function type(s) {
  var input = document.getElementById('testarea');
  for (var i = 0; i < s.length; i++) {
    pressAndRelease(s.charAt(i));
  }
}


function show(s) {
  var buf = [];
  for (var i = 0; i < s.length; i++) {
    var c= s.charCodeAt(i);
    var hex = c.toString(16);
    while (hex.length < 4) hex = '0' + hex;
    buf.push((c < 128 && c > 31) ? s.charAt(i) : ("\\u" + hex));
  }
  return buf.join("");
}

function testPresence() {
  assertFalse(GKBD.Layout === undefined);
}

function testSaveRestore() {
  GKBD.layer.switchTo_('HE');
  checkSaveRestore(titleInactive, 'KBD=0HE3');
}

function testTitleInactive() {
  checkInactiveTitle(titleInactive);
}

function testTitleActive() {
  checkActiveTitle(titleHebrewActive);
}

function testTypeRu() {
  GKBD.layer.showAs_('v');
  var input = document.getElementById('testarea');
  assertEquals('', input.value);
  GKBD.layer.switchTo_('RU');
  type('Heccrfz rkfdbfnehf');
  assertEquals('\u0420\u0443\u0441\u0441\u043a\u0430\u044f' +
               '\u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0430',
               input.value);
}

function testTypeHe() {
  GKBD.layer.showAs_('v');
  GKBD.layer.switchTo_('HE');
  var input = document.getElementById('testarea');
  assertEquals('', input.value);
  type('ERTYUIOPertyuiop');
  assertEquals("Got " + show(input.value),
               'ERTYUIOP\u05e7\u05e8\u05d0\u05d8\u05d5\u05df\u05dd\u05e4',
               input.value);
}

function testTypeAr() {
  GKBD.layer.showAs_('v');
  GKBD.layer.switchTo_('AR');
  var input = document.getElementById('testarea');
  assertEquals('', input.value);
  type('QWERTYUIOPqwertyuiop');
  var expected =
      '\u064e\u064b\u064f\u064c\u0644\u0625\u0625\u2018\u00f7\u00d7\u061b' +
      '\u0636\u0635\u062b\u0642\u0641\u063a\u0639\u0647\u062e\u062d';
  assertEquals("Got " + show(input.value) + "\nvs " + show(expected),
               expected,
               input.value);
}

function testTypeEn() {
  GKBD.layer.showAs_('v');
  GKBD.layer.switchTo_('EN');
  var input = document.getElementById('testarea');
  assertEquals('', input.value);
  type('ONCE UPON A MIDNIGHT DREARY, while I pondered, weak and weary');
  assertEquals('ONCEUPONAMIDNIGHTDREARYwhileIponderedweakandweary',
      input.value); // no space bar here! :)
}
</script>
</body>
</html>
