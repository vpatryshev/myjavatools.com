<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Onscreen Keyboard Test Suite. Unittest for kbdlayer.js</title>
<!--
Javascript unittest file. See instructions in the body.
Script paths are relative to location of this file.
Author: vpatryshev
-->
  <script src="../../../third_party/java/jsunit/jsunit2.2/app/jsUnitCore.js"></script>
  <script>
    if (!jsUnitFixTop) {
      alert("Sorry, could not find jsUnitCore.js; please check your paths...");
    }
  </script>
  <script src="header.js"></script>
  <script src="debug.js"></script>
  <script src="unittest_util.js"></script>
  <script src="keyboard.js"></script>
  <script src="kbdlayout.js"></script>
  <script src="kbdlayer.js"></script>
  <script src="kbdlayerdrag.js"></script>
  <script src="export.js"></script>
</head>
<body>
This is a javascript unittest for <code>kbdlayerdrag.js</code><br>
To run the test, you have to open in your browser the following file:<br>
<code>google3/third_party/java/jsunit/jsunit2.2/testRunner.html</code><br>
and enter the location of this test file into the file name field,
and click 'Run' button.
<textarea rows="2" cols="50" id="testarea"></textarea>
<script type="text/javascript">
var kbdRestore = KBD_window._kbdInit;

var layout1 = new GKBD.Layout({
  id:'RU_LATN,Ru:Russian (Translit)',
  titleProvider : function() { return "this is a title";},
  tooltip: "here be keyboard tooltip",
  shortTitle: "keyboard is disabled",
  mappings: {
    'sl':{'\u00c0':'\u044a','1':'!','2':'@','3':'"','4':'$','5':'%','6':'^',
          '7':'&','8':'*','9':'(','0':')','m':'_','=':'\u044c' ,
          'Q':'\u044f','W':'\u0436','E':'\u0435','R':'\u0440','T':'\u0442',
          'Y':'\u044b','U':'\u0443','I':'\u0438','O':'\u043e','P':'\u043f',
          '\u00db':'\u0448','\u00dd':'\u0449','\u00dc':'\u044d' ,
          'A':'\u0430','S':'\u0441','D':'\u0434','F':'\u0444','G':'\u0433',
          'H':'\u0447','J':'\u0439','K':'\u043a','L':'\u043b',';':':',
          '\u00de':'"' ,
          'Z':'\u0437','X':'\u0445','C':'\u0446','V':'\u0432','B':'\u0431',
          'N':'\u043d','M':'\u043c','\u00bc':'<','\u00be':'>','\u00bf':'?'
         },
    'l': {'\u00c0':'\u042a','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6',
          '7':'7','8':'8','9':'9','0':'0','m':'-','=':'\u042c' ,
          'Q':'\u042f','W':'\u0416','E':'\u0415','R':'\u0420','T':'\u0422',
          'Y':'\u042b','U':'\u0423','I':'\u0418','O':'\u041e','P':'\u041f',
          '\u00db':'\u0428','\u00dd':'\u0429','\u00dc':'\u042d' ,
          'A':'\u0410','S':'\u0421','D':'\u0414','F':'\u0424','G':'\u0413',
          'H':'\u0427','J':'\u0419','K':'\u041a','L':'\u041b',';':';',
          '\u00de':'\'' ,
          'Z':'\u0417','X':'\u0425','C':'\u0426','V':'\u0412','B':'\u0411',
          'N':'\u041d','M':'\u041c','\u00bc':',','\u00be':'.','\u00bf':'/'
         },
    's': {'\u00c0':'\u042a','1':'!','2':'@','3':'"','4':'$','5':'%','6':'^',
          '7':'&','8':'*','9':'(','0':')','m':'_','=':'\u042c' ,
          'Q':'\u042f','W':'\u0416','E':'\u0415','R':'\u0420','T':'\u0422',
          'Y':'\u042b','U':'\u0423','I':'\u0418','O':'\u041e','P':'\u041f',
          '\u00db':'\u0428','\u00dd':'\u0429','\u00dc':'\u042d',
          'A':'\u0410','S':'\u0421','D':'\u0414','F':'\u0424','G':'\u0413',
          'H':'\u0427','J':'\u0419','K':'\u041a','L':'\u041b',';':':',
          '\u00de':'"' ,
          'Z':'\u0417','X':'\u0425','C':'\u0426','V':'\u0412','B':'\u0411',
          'N':'\u041d','M':'\u041c','\u00bc':'<','\u00be':'>','\u00bf':'?'
         },
    '':  {'\u00c0':'\u044a','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6',
          '7':'7','8':'8','9':'9','0':'0','m':'-','=':'\u044c' ,
          'Q':'\u044f','W':'\u0436','E':'\u0435','R':'\u0440','T':'\u0442',
          'Y':'\u044b','U':'\u0443','I':'\u0438','O':'\u043e','P':'\u043f',
          '\u00db':'\u0448','\u00dd':'\u0449','\u00dc':'\u044d',
          'A':'\u0430','S':'\u0441','D':'\u0434','F':'\u0444','G':'\u0433',
          'H':'\u0447','J':'\u0439','K':'\u043a','L':'\u043b',';':';',
          '\u00de':'\'',
          'Z':'\u0437','X':'\u0445','C':'\u0446','V':'\u0432','B':'\u0431',
          'N':'\u043d','M':'\u043c','\u00bc':',','\u00be':'.','\u00bf':'/'
         },
    'sc':{'=':'+', 'O':'\u0405', 'B':'\u0406', 'Q':'\u0407', 'J':'\u0460',
          'K':'\u047e','\u00c0':'\u0462','T':'\u0464','Z':'\u0466',
          'X':'\u0468','E':'\u046a','R':'\u046c','P':'\u046e','S':'\u0470',
          'A':'\u0472','N':'\u0474','M':'\u0476','W':'\u0478','L':'\u047a',
          ';':'\u047c','\u00db':'{','\u00dd':'}','\u00dc':'|'
         },
    'cl':{'=':'+','O':'\u0405','B':'\u0406','Q':'\u0407','J':'\u0460',
         'K':'\u047e','\u00c0':'\u0462','T':'\u0464','Z':'\u0466',
         'X':'\u0468','E':'\u046a','R':'\u046c','P':'\u046e','S':'\u0470',
         'A':'\u0472','N':'\u0474','M':'\u0476','W':'\u0478','L':'\u047a',
         ';':'\u047c','\u00db':'[','\u00dd':']','\u00dc':'\\'
        },
    'c': {'=':'=','O':'\u0455','B':'\u0456','Q':'\u0457','J':'\u0461',
          'K':'\u047f','\u00c0':'\u0463','T':'\u0465','Z':'\u0467',
          'X':'\u0469','E':'\u046b','R':'\u046d','P':'\u046f','S':'\u0471',
          'A':'\u0473','N':'\u0475','M':'\u0477','W':'\u0479','L':'\u047b',
          ';':'\u047d','\u00db':'[','\u00dd':']','\u00dc':'\\'
         },
    'scl':{'=':'=','O':'\u0455','B':'\u0456','Q':'\u0457','J':'\u0461',
           'K':'\u047f','\u00c0':'\u0463','T':'\u0465','Z':'\u0467',
           'X':'\u0469','E':'\u046b','R':'\u046d','P':'\u046f','S':'\u0471',
           'A':'\u0473','N':'\u0475','M':'\u0477','W':'\u0479','L':'\u047b',
           ';':'\u047d','\u00db':'{','\u00dd':'}','\u00dc':'|'
          }
    },
    transform: {
      //           jo                      ju
      '\u0439\u043e':'\u0451','\u0439\u0443':'\u044e',
      '\u0419\u041e':'\u0401','\u0419\u0423':'\u042e',
      //           yo                      yu
      '\u044b\u043e':'\u0451','\u044b\u0443':'\u044e',
      '\u042b\u041e':'\u0401','\u042b\u0423':'\u042e'
    }
});

var titleArea = null;

// fake client width calculator
GKBD.layer.clientWidth_ = function() {
  return 1000;
}

// fake client height calculator
GKBD.layer.clientHeight_ = function() {
  return 500;
}

function mousedown(x, y) {
  var event = {clientX: x,
               clientY: y};
  titleArea.onmousedown(event);
}

function mousemove(x, y) {
  document.onmousemove({clientX: x, clientY: y});
}

function mouseup(x, y) {
  document.onmouseup({clientX: x, clientY: y});
}

function focuslost(x, y) {
  document.onblur({clientX: x, clientY: y});
}

function setupLayer() {
  GKBD.layer.addLayout_("-", layout1);
  GKBD.layer.setDefaultLayout_(layout1);
  GKBD.layer.setup();
}

function setUp() {
  DEBUG = false;
  setupLayer();
  GKBD.layer.switchTo_('RU');
  titleArea = document.getElementById('kbd_t');
  GKBD.layer.moveTo_(200, 300);
}

function tearDown() {
  titleArea = null;
}

function testPresence() {
  assertFalse(GKBD.Layout === undefined);
  assertFalse(titleArea === undefined);
  assertFalse(titleArea.onmousedown === undefined);
}

function testDragging() {
  assertEquals(200, GKBD.layer.left());
  var x0 = GKBD.layer.x_;
  var y0 = GKBD.layer.y_;
  mousedown(217, 359);
  mousemove(222, 333);
  mouseup();
  var x1 = GKBD.layer.x_;
  var y1 = GKBD.layer.y_;
  var log="was: (" + x0 + "," + y0 + "), now (" + x1 + "," + y1 + ")";
  assertEquals(log, 205, x1);
  assertEquals(log, 274, y1);
}

</script>
</body>
</html>
