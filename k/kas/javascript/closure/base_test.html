<!--
Copyright 2006 Google Inc.
 All Rights Reserved.
-->

<html>
<head>

<script type="text/javascript" src="../../third_party/java/jsunit/jsunit2.2/app/jsUnitCore.js"></script>
<script type="text/javascript" src="base.js"></script>
<script type="text/javascript">
// Used to test dynamic loading works, see testRequire*
goog.require('goog.Timer');

// NOTE(pupius): Continuous doesn't have this in the target
//goog.require('google3.javascript.creditcard');
</script>
<script type="text/javascript">

/**
 * Unit test for Closure's 'base' script.
 */

//=== tests for library ===

function testLibrary() {
  assertNotUndefined("'goog' not loaded", goog);
}

function testProvide() {
  goog.provide('goog.test.name.space');
  assertNotUndefined('provide failed: goog.test', goog.test);
  assertNotUndefined('provide failed: goog.test.name', goog.test.name);
  assertNotUndefined('provide failed: goog.test.name.space',
      goog.test.name.space);
}

function testGlobalize() {
  goog.globalize();
  assertNotUndefined('Globalize goog', provide);

  var a = { a:1, b:2, c:3 };
  var b = {};
  goog.globalize(a, b);
  assertNotUndefined('Globalize to arbitrary object', b.a);
  assertNotUndefined('Globalize to arbitrary object', b.b);
  assertNotUndefined('Globalize to arbitrary object', b.c);
}


//=== tests for Require logic ===

function testRequireClosure() {
  assertNotUndefined('goog.Timer should be available', goog.Timer);
  assertNotUndefined('goog.events.EventTarget should be available', goog.events.EventTarget);
}

function testRequireGoogle3Javascript() {
  // NOTE(pupius): Continuous doesn't have this in the target
  // assertNotUndefined('Credit card code should have loaded', CC_CreditCard);
}


//=== tests for language enhancements ===

function testIsDef() {
  var defined = 'foo';
  var nullVar = null;
  var notDefined;

  assertTrue('defined should be defined', goog.isDef(defined));
  assertTrue('null should be defined', goog.isDef(defined));
  assertFalse('undefined should not be defined', goog.isDef(notDefined));
}

function testIsNull() {
  var notNull = 'foo';
  var nullVar = null;
  var notDefined;

  assertFalse('defined should not be null', goog.isNull(notNull));
  assertTrue('null should be null', goog.isNull(nullVar));
  assertFalse('undefined should not be null', goog.isNull(notDefined))
}

function testIsArray() {
  var array = [1,2,3];
  var objWtihArrayFunctions = {join: function() {}, reverse: function() {}};
  var object = {a: 1, b: 2, c: 3};
  var nullVar = null;
  var notDefined;

  assertTrue('array should be an array', goog.isArray(array));
  assertTrue('object with array functions should be an array',
      goog.isArray(objWtihArrayFunctions));
  assertFalse('object should not be an array', goog.isArray(object));
  assertFalse('null should not be an array', goog.isArray(nullVar));
  assertFalse('undefined should not be an array', goog.isArray(notDefined));
}

function testIsArrayLike() {
  var array = [1,2,3];
  var objectWithNumericLength = {length: 2};
  var objectWithNonNumericLength = {length: 'a'};
  var object = {a: 1, b: 2};
  var nullVar = null;
  var notDefined;

  assertTrue('array should be array-like', goog.isArrayLike(array));
  assertTrue('obj w/numeric length should be array-like',
      goog.isArrayLike(objectWithNumericLength));
  assertFalse('obj w/non-numeric length should not be array-like',
      goog.isArrayLike(objectWithNonNumericLength));
  assertFalse('object should not be array-like', goog.isArrayLike(object));
  assertFalse('null should not be array-like', goog.isArrayLike(nullVar));
  assertFalse('undefined should be array-like', goog.isArrayLike(notDefined));
}

function testIsString() {
  var string = 'foo';
  var number = 2;
  var nullVar = null;
  var notDefined;

  assertTrue('string should be a string', goog.isString(string));
  assertFalse('number should not be a string', goog.isString(number));
  assertFalse('null should not be a string', goog.isString(nullVar));
  assertFalse('undefined should not be a string', goog.isString(notDefined));
}

function testIsBoolean() {
  var boolean = true;
  var string = 'true';
  var number = 1;
  var nullVar = null;
  var notDefined;

  assertTrue('boolean should be a boolean', goog.isBoolean(boolean));
  assertFalse('string should not be a boolean', goog.isBoolean(string));
  assertFalse('number should not be a boolean', goog.isBoolean(number));
  assertFalse('null should not be a boolean', goog.isBoolean(nullVar));
  assertFalse('undefined should not be a boolean', goog.isBoolean(notDefined));
}

function testIsNumber() {
  var number = 1;
  var string = '1';
  var nullVar = null;
  var notDefined;

  assertTrue('number should be a number', goog.isNumber(number));
  assertFalse('string should not be a number', goog.isNumber(string));
  assertFalse('null should not be a number', goog.isNumber(nullVar));
  assertFalse('undefined should not be a number', goog.isNumber(notDefined));
}

function testIsFunction() {
  var func = function() { return 1; };
  var object = {a: 1, b: 2};
  var nullVar = null;
  var notDefined;

  assertTrue('function should be a function', goog.isFunction(func));
  assertFalse('object should not be a function', goog.isFunction(object));
  assertFalse('null should not be a function', goog.isFunction(nullVar));
  assertFalse('undefined should not be a function', goog.isFunction(notDefined));
}

function testIsObject() {
  var object = {a: 1, b: 2};
  var string = 'b';
  var nullVar = null;
  var notDefined;

  assertTrue('object should be an object', goog.isObject(object));
  assertFalse('string should not be an object', goog.isObject(string));
  assertFalse('null should not be an object', goog.isObject(nullVar));
  assertFalse('undefined should not be an object', goog.isObject(notDefined));
}

//=== tests for hashcode methods ===

function testGetHashCode() {
  var a = {};
  var b = {};
  var c = {};

  var hc1 = goog.getHashCode(a);
  var hc2 = goog.getHashCode(b);
  var hc3 = goog.getHashCode(c);

  assertNotEquals("Hash codes must be unique", hc1, hc2);
  assertNotEquals("Hash codes must be unique", hc1, hc3);
  assertNotEquals("Hash codes must be unique", hc2, hc3);
}

function testRemoveHashCodeFromPlainObject() {
  var a = {};
  var hash = goog.getHashCode(a);
  goog.removeHashCode(a);
  assertNotEquals("An object's old and new hashcodes should be different",
      hash, goog.getHashCode(a));
}

function testRemoveHashCodeFromObjectWithoutHashCode() {
  var a = {};
  try {
    goog.removeHashCode(a);
  } catch (e) {
    fail('Removing a hash code should not fail even if it did not exist');
  }
}

function testRemoveHashCodeFromNode() {
  var node = document.createElement('div');
  var nodeHash = goog.getHashCode(node);
  goog.removeHashCode(node);
  assertNotEquals("A node's old and new hashcodes should be different",
      nodeHash, goog.getHashCode(node));
}

//=== tests for clone method ===

function testClonePrimitive() {
  assertEquals('cloning a primitive should return an equal primitive',
      5, goog.cloneObject(5));
}

function testCloneObjectThatHasACloneMethod() {
  var original = {
    name: 'original',
    clone: function() { return { name: 'clone' } }
  };

  var clone = goog.cloneObject(original);
  assertEquals('original', original.name);
  assertEquals('clone', clone.name);
}

function testCloneFlatObject() {
  var original = {a:1, b:2, c:3};
  var clone = goog.cloneObject(original);
  assertNotEquals(original, clone);
  assertEquals(1, clone.a);
  assertEquals(2, clone.b);
  assertEquals(3, clone.c);
}

function testCloneDeepObject() {
  var original = {
    a: 1,
    b: { c: 2, d: 3 },
    e: { f: { g: 4, h: 5 } }
  };
  var clone = goog.cloneObject(original);

  assertNotEquals(original, clone);
  assertNotEquals(original.b, clone.b);
  assertNotEquals(original.e, clone.e);

  assertEquals(1, clone.a);
  assertEquals(2, clone.b.c);
  assertEquals(3, clone.b.d);
  assertEquals(4, clone.e.f.g);
  assertEquals(5, clone.e.f.h);
}

function testCloneFunctions() {
  var original = { f: function() { return 'hi'; } };
  var clone = goog.cloneObject(original);

  assertNotEquals(original, clone);
  assertEquals('hi', clone.f());
  assertEquals(original.f, clone.f);
}

//=== tests for bind() and friends ===

var foo = "global";
var obj = {foo:"obj"};

function getFoo(arg1, arg2) {
  return {foo:this.foo, arg1:arg1, arg2:arg2};
}

function testBindWithoutObj() {
  assertEquals(foo, getFoo.bind()().foo);
}

function testBindWithObj() {
  assertEquals(obj.foo, getFoo.bind(obj)().foo);
}

function testBindWithNullObj() {
  assertEquals(foo, getFoo.bind()().foo);
}

function testBindStaticArgs() {
  var fooprime = getFoo.bind(obj, "hot", "dog");
  var res = fooprime();
  assertEquals(obj.foo, res.foo);
  assertEquals("hot", res.arg1);
  assertEquals("dog", res.arg2);
}

function testBindDynArgs() {
  var res = getFoo.bind(obj)("hot", "dog");
  assertEquals(obj.foo, res.foo);
  assertEquals("hot", res.arg1);
  assertEquals("dog", res.arg2);
}

function testBindCurriedArgs() {
  var res = getFoo.bind(obj, "hot")("dog");
  assertEquals(obj.foo, res.foo);
  assertEquals("hot", res.arg1);
  assertEquals("dog", res.arg2);
}

function testBindDoubleBind() {
  var getFooP = goog.bind(getFoo, obj, "hot");
  var getFooP2 = goog.bind(getFooP, null, "dog");

  assertEquals("getFooP.boundFn_ should equal getFoo",
      getFoo, getFooP.boundFn_);
  assertEquals("getFooP.boundArgs_ should have length 1",
      1, getFooP.boundArgs_.length);
  assertEquals("getFooP2.boundFn_ should equal getFoo",
      getFoo, getFooP2.boundFn_);
  assertEquals("getFooP2.boundArgs_ should have length 2",
      2, getFooP2.boundArgs_.length);
  assertEquals("getFooP2.boundArgs_[0] should be 'hot'",
      "hot", getFooP2.boundArgs_[0]);
  assertEquals("getFooP2.boundArgs_[1] should be 'dog'",
      "dog", getFooP2.boundArgs_[1]);
  assertEquals("getFooP.boundSelf_ should equal obj.",
      obj, getFooP.boundSelf_);
  assertEquals("getFooP2.boundSelf_ should equal obj.",
      obj, getFooP2.boundSelf_);

  var res = getFooP2();
  assertEquals("res.arg1 should be 'hot'", "hot", res.arg1);
  assertEquals("res.arg2 should be 'dog'", "dog", res.arg2);
}

</script>

</head>

<body>

</body>
</html>
